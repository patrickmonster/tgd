<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta http-equiv="Pragma" content="no-cache">
		<meta http-equiv="Cache-Control" content="no-cache">
		<meta http-equiv="expires" content="0">
		<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible' />
		<meta name="viewport" content="width=device-width, user-scalable=no">

		<meta property="og:locale" content="ko_KR" />
		<meta property="og:site_name" content="네오캣짱">
		<meta property="og:title" content="방송이펙트">
		<meta property="og:type" content="website">
		<meta property="og:description" content="네오캣짱 - 방송이펙트">
		<meta property="og:image" content="https://cdn.discordapp.com/attachments/674561497267044363/684192692535689276/KakaoTalk_20200303_031352348.png">
		<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
		<title>방송 효과</title>

		<script type="text/javascript" charset="utf-8" src="https://patrickmonster.github.io/effect/js/all.min.js"></script>
		<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
		<script defer src="https://patrickmonster.github.io/tgd/js/jquery.minicolors.min.js"></script>
	  <link rel="stylesheet" href="https://patrickmonster.github.io/tgd/css/jquery.minicolors.css">
		<style media="screen">
@font-face {font-family:"title";src: url("font/title.woff") format("woff");}

iframe{
	border: 0;
	color: #fff;
}
@keyframes neon {
  0%,
  100% {
    text-shadow: 0 0 1vw #FA1C16, 0 0 3vw #FA1C16, 0 0 10vw #FA1C16, 0 0 10vw #FA1C16, 0 0 .4vw #FED128, .5vw .5vw .1vw #806914;
    color: #FED128;
  }
  50% {
    text-shadow: 0 0 .5vw #800E0B, 0 0 1.5vw #800E0B, 0 0 5vw #800E0B, 0 0 5vw #800E0B, 0 0 .2vw #800E0B, .5vw .5vw .1vw #40340A;
    color: #806914;
  }
}

body,div,dl,dt,dd,ul,ol,li,h1,h2,h3,h4,h5,h6,pre,
form,fieldset,input,textarea,p,blockquote,th,td {
	padding: 0;
	margin: 0;
}
body,html{
	background: #000;
	width:100%;
	height: 100%;
	color: #fff;
	overflow: hidden;
}

#title{
  font-family: 'title';
  font-size: 1.3em;
  line-height: 2vw;
  color: #FB4264;
  text-shadow: 0 0 3vw #F40A35;
  animation: neon 1s ease infinite;
  -moz-animation: neon 1s ease infinite;
  -webkit-animation: neon 1s ease infinite;
}

body #main, body #menu{
	display: inline-block;
}

#effect_bord{
	position:absolute;
	width:100%;
	height:100%;
	top:0;
	left:0;
}
#flake img{
	width: 3vh;
	height:3vh;
}
nav{
	display:inline;
	float:left
}

#menu{
	background: #9147ff;
	/* width: 200px; */
	width: 50px;
	height: 100%;
	overflow: hidden;
	text-overflow: hidden;
	transition: 1s;
}
#title,
#menu ul li span{
	opacity: 0;
	transition: .5s;
	box-sizing:border-box;
}
#menu:hover{
	width: 200px;
	transition: .5s;
}
#menu:hover #title,
#menu:hover ul li span{
	opacity: 1;
	transition: 1s;
}
#menu ul li{
	margin: 10px;
	height: 21px !important;
	color: #fff;
	text-overflow: clip;
}
#menu:hover #neocat,
#title_n{
	opacity: 1 !important;
	transition: 1s;
}
#neocat,
#menu:hover #title_n{
	opacity: 0 !important;
	transition: 1s;
}
#menu,#main{
	float: left;
}
#menu a{
	text-decoration: none;
	color: #fff;
}
/* 매인 컨텐츠 */
#login{
	position: fixed;
  right: 0;
  top: 0;
	cursor: pointer;
}

#main{
	height: 100%;
	width: calc(100% - 200px);
}

#content{
  padding: 50px;
  height: calc(100% - 100px);
}
#content .main{
	position: relative;
	width: 100%;
	height: 100%;
	transform: translate(-50%, -50%);
	/* overflow-y: auto;
	overflow-x: hidden; */
	top: 50%;
	left: 50%;
}

#menu ul a{
	cursor: pointer;
}
		</style>
</head>
<body>
<div id="menu">
	<ul>
		<li><span id=title_n style="cursor:default;"><i class="fas fa-bars"></i></span><span id=title style="font-family:'title';cursor:default">방송화면 이펙트</span>
		<li><a onclick="if(location.hash=='#home')return;location.hash='home';load_page()"><i class="fas fa-home"></i> <span>매인</span> </a></a></li>
		<li><a onclick="if(location.hash=='#effect')return;location.hash='effect';load_page()"><i class="fas fa-sparkles"></i> <span>이펙트</span> </a></li>
		<li><a onclick="if(location.hash=='#tts')return;location.hash='tts';load_page()"><i class="fas fa-comment-alt-smile"></i> <span>TTS/크로마키</span> </a></li>
		<li><a onclick="if(location.hash=='#emote')return;location.hash='emote';load_page()"><i class="far fa-smile"></i> <span>이모티콘/미니도네</span> </a></li>
		<li><a onclick="if(location.hash=='#question')return;location.hash='question';load_page()"><i class="fas fa-question-circle"></i> <span>적용법</span> </a></li>
		<li><a onclick="if(location.hash=='#programmer')return;location.hash='programmer';load_page()"><i class="fad fa-window"></i> <span>개발자</span> </a></li>
		<li><a href="https://discord.gg/Th3a6JE" target="_blank"><i class="fab fa-discord"></i> <span>디스코드</span></a></li>
		<!-- https://discord.gg/Th3a6JE -->
	</ul>
	<div id="neocat" style="vertical-align:bottom;position: absolute;bottom:0;text-overflow:none">
		네오캣<br/>
		@neocats_
	</div>
</div>
<div id="main">
	<div id=content>로딩...</div>
</div>
<!-- 로그인 섹션 -->
<div id="login" onclick="permiss();console.log('login')"><i class="fab fa-twitch"></i> 로그인</div>
<div id=cover style="width:1;height:1"></div>
<!-- <div id="effect_bord"></div> -->

<!-- <script src="http://patrickmonster.github.io/irc_chat_client/chat.js" charset="utf-8"></script> -->
<script src="https://rawcdn.githack.com/blueimp/JavaScript-MD5/v2.10.0/js/md5.min.js" charset="utf-8"></script>
<script src="https://patrickmonster.github.io/effect/v.2/js/effect.js" charset="utf-8"></script>
<script src="https://patrickmonster.github.io/effect/js/option.js" charset="utf-8"></script>
<script src="js/jscolor.js" charset="utf-8"></script>
<script src="https://patrickmonster.github.io/irc_chat_client/chat.js" charset="utf-8"></script>
<!-- <script  src="js/main.js" charset="utf-8"></script> -->
<script type="text/javascript">
Element.prototype.createElement=Element.prototype.C=function(ele){var ele=document.createElement(ele);this.appendChild(ele);return ele};
window.addScript=document.addScript=function(a,b){b=document.head.C('script');b.src=a;return b};
window.addLink=document.addLink=function(a,b){b=document.head.C('link');b.src=a;return b};
window.addStyle=document.addStyle=function(a,b){b=document.head.C('style');b.innerHTML=a;return b};

window.badlist = ["410369648","414699830","204552253","433529894"];

window.oauth_client_id = "g1rhyzp1s7y2d755xqjn1otspdgvc3";
window.oauth_redirect_uri = "https://patrickmonster.github.io/tgd/";
//채팅
let commandSant = {
	command:null,channel:null,user:{}, conn:0,chat:0,chats:[],
	onChat:0
},onStop,options;
var effect_style=document.addStyle("");
if (document.location.hash.indexOf("access_token")!=-1){
	permiss();
}else{
	const oauth = localStorage.getItem("oauth");
	if(oauth){
		if(!isPermiss()){
			localStorage.removeItem("oauth");
			alert("세션이 만료되어 로그아웃 되셧습니다!\n다시 로그인 해주세요!");
		}else{
			if(window.badlist.indexOf(JSON.parse(getChannel(oauth))["user_id"])!=-1){
				location.href="about:blank";
			}
			if(oauth){
				ChatConnect(oauth);
				connectCommand(oauth);
			}//로그인이 되지 않음
		}
	}
	load_page();
	options = getEffect({effect:"cherryblossom2",target:"#cover"});
	$.fn.effect(options);
}
//=============================== 이펙트 모듈 ===============================

//이펙트 변경
function changedEffect(){
	clearEffect();
	options = getEffect({effect:document.getElementById("option1").selectedOptions[0].value,target:"#cover"});
	$.fn.effect(options);
	document.getElementById("count_selecter").value=options.count;
	document.getElementById("speed_selecter").value=options.speed;
}
function changedOptions() {
	clearEffect();
	options=getEffect(getEffectOption());
	options.target="#cover";
	$.fn.effect(options);
}

function clearEffect(){document.getElementById("cover").innerHTML=""}

function getURL(){
	var options=getEffectOption(),out=[];//https://patrickmonster.github.io/effect/v.2/?effect=
	options.color=options.color;
	for(var i in options)
		out.push(i+"="+options[i]);
	return "https://patrickmonster.github.io/effect/v.2/?"+out.join("&");
}

function changeColor(color){
	effect_style.innerHTML='#flake{color:'+color+' !important}';
}

function getEffectOption(){
	var color = document.getElementById('color_selecter').value;
	if(color[0]=="#")color=color.substring(1);
	var e={
		count:document.getElementById("count_selecter").value,
		color:color,
		speed:document.getElementById("speed_selecter").value,
		effect: document.getElementById("option1").selectedOptions[0].value + (document.getElementById("rand").checked?"rand":""),
	};
	if(document.getElementById("rand").checked){
		e.x=document.getElementById("rand_x").value;
		e.y=document.getElementById("rand_y").value;
	}
	return e;
}

//=============================== TTS 모듈 ===============================


let voices = [],setVoiceList=()=>{
	voices=window.speechSynthesis.getVoices();
};
setVoiceList();
if (window.speechSynthesis.onvoiceschanged !== undefined){
	window.speechSynthesis.onvoiceschanged=setVoiceList;
}

function callCromarkey(name){
	commandSant.command.onSend("*"+name);
}

function removeCromarkey(name){
	delete cromarks[name];
	reCromarkey();
	commandSant.command.onSend(commandSant.channel.channel+" #영상 "+name+" \'");
	localStorage.setItem("chromakey",JSON.stringify(cromarks));
}

function addCromarkey(name,url,a){
	if(!url||a)alert("잘못된 형식");
	cromarks[name] = url;
	reCromarkey();
	commandSant.command.onSend(commandSant.channel.channel+" #영상 "+name+" "+url);
	localStorage.setItem("chromakey",JSON.stringify(cromarks));
}

//TTS용
//=============================== 채팅 모듈 ===============================
var users=["nightbot","twipkr","bbangddeock","ssakdook"],users_lenght=users.length;
var voices_user=[],cromarks=JSON.parse(localStorage.getItem("chromakey"))||{"oh":"https://cdn.discordapp.com/attachments/684630428908388352/684631231933054986/Oh_oh_oh_Chroma_Key-o7WVRrA89-s.mp4"},
	reCromarkey;
function TTS_Chatuser_add(display_id){
	commandSant.channel.getUser(display_id,function(t){
		var u=JSON.parse(t)["users"][0];
		voices_user.push([display_id,"<a onclick=''></a>"]);
	})
}


function ChatConnect(oauth){// 사용자 채널에 연결
	commandSant.channel=new chatClient({password:oauth});
	commandSant.channel.isMood=true;//매니져 권한
	commandSant.channel.onCommand=function(message,parsed){
		if(commandSant.conn)
			commandSant.conn.call(commandSant.channel,message,parsed);
	};
	commandSant.channel.onChating=function(parsed){//채팅 인식
		commandSant.chats.push({"display-name":parsed["display-name"],"display-id":parsed["display-id"],"message":parsed["message"]});
		var message=parsed["message"].split(" ");
		if("#영상".indexOf(message[0])!=-1){
			if(message[2].indexOf("'")!=-1){//제거
				if(list.hasOwnProperty(message[1]))
					delete list[message[1]];
			}else list[message[1]] = message[2];
		}else if(commandSant.chat)
			commandSant.chat.call(commandSant.channel,parsed);
	};
	commandSant.channel.getUser(commandSant.channel.username,function(t){
		console.log(t);
		commandSant.user=JSON.parse(t)["users"][0];
		var ele =document.getElementById("login");
		voices_user.push([commandSant.user["display-id"],"<a onclick=''>"+commandSant.user["display-name"]+"</a>"]);

		users.push(commandSant.user["name"]);
		users_lenght=users.length;

		ele.innerHTML=commandSant.user["display_name"]+"님 반갑습니다";
		ele.setAttribute("onclick","");
	});
	commandSant.channel.open();
	//display-name
}

// 통신 데이터  - 사용자 _id
//{"display_name":"네오캣짱","_id":"129955642","name":"neocats_","type":"user","bio":null,
//"created_at":"2016-07-19T12:28:20.760139Z","updated_at":"2020-03-22T22:30:44.942731Z","logo":"로고"}

//명령 채널
function connectCommand(oauth){//명령 채널에 연결
	const target="recodingbot";//명령 채
	if(commandSant.command)return //commandSant.channel.close();//기존연결 해제
	commandSant.command = new chatClient({channel:target,username:commandSant.channel.username,password:oauth});
	/*
	commandSant.command.isMood=true;//매니져 권한
	commandSant.command.onCommand=function(comm,parsed){
		//동일 채널 명령이거나
		if(parsed["_id"] != commandSant.user['_id'])return;//채널명이 동일하지 않으면 제거
		delete comm[0];
		for(var i of commandSant.conn){
			if(i.hasOwnProperty("onCommand"))
				i.onCommand(comm,parsed);
		}
	}*/
	commandSant.command.open();
}

function sandCommand(comm){
	commandSant.command.onSend("#"+commandSant.user['_id']+" "+comm);
}

//=============================== 기본 모듈 ===============================
function getParams(name, address = window.location.href) {
	let url;
	let results = "";
	url = new URL(address);
	if (typeof url.searchParams === 'undefined') {
		results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(address);
		if (results == null) {
			return null;
		} else {
			return decodeURI(results[1]) || 0;
		}
	} else {
		return url.searchParams.get(name);
	}
}

//=============================== 페이지 모듈 ===============================
function load_page(){
	if(!location.hash||
			["#home","#effect","#tts","#emote","#cromark","#timmer","#question","#programmer","#donate","#discord"].indexOf(location.hash)==-1)
		location.hash="home";
	// console.log("./page/"+location.hash.substring(1)+".html");

	// document.getElementById("main").setAttribute("src","./page/"+location.hash.substring(1)+".html");
	ajax("./page/"+location.hash.substring(1)+".html",function(txt){
		let ele = document.getElementById("content");
		ele.innerHTML=txt;
		var scripts = ele.getElementsByTagName("script");
		for(var i of scripts)
			eval(i.innerHTML);
		if(location.hash=="#effect"){
			console.log(document.getElementById("option1"));
			console.log(options);
			document.getElementById("count_selecter").value=options.count;
			document.getElementById('color_selecter').value=options.color||"#ffffff";
			document.getElementById("speed_selecter").value=options.speed;

		}
	});
}

function ajax(url,f){//호출
	var xmlhttp;
	if(window.XMLHttpRequest)
		xmlhttp=new XMLHttpRequest();
	else xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
	xmlhttp.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200) {
			//item(JSON.parse(this.responseText),tap);
			typeof f=='function'&&f(this.responseText);
		}
	};
	xmlhttp.open("GET",url, true);
	xmlhttp.send();
}

function copyToClipboard(value) {
  var aux = document.createElement("input");
  aux.setAttribute("value", value);
  document.body.appendChild(aux);
  aux.select();
  document.execCommand("copy");
	document.body.removeChild(aux);
}

</script>
</body>
</html>
